"use strict";var v=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var i in t)v(e,i,{get:t[i],enumerable:!0})},U=(e,t,i,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $(t))!G.call(e,s)&&s!==i&&v(e,s,{get:()=>t[s],enumerable:!(p=M(t,s))||p.enumerable});return e};var Y=e=>U(v({},"__esModule",{value:!0}),e);var z={};Q(z,{default:()=>B});module.exports=Y(z);var S=require("@raycast/api"),I=require("react");var a=require("@raycast/api"),g=require("react/jsx-runtime");var P=e=>(0,g.jsx)(a.Action.CopyToClipboard,{icon:a.Icon.CopyClipboard,...e}),D=({onAction:e})=>(0,g.jsx)(a.Action,{icon:a.Icon.Star,title:"Save Answer",onAction:e,shortcut:{modifiers:["cmd"],key:"s"}}),H=({text:e,name:t})=>(0,g.jsx)(a.Action.CreateSnippet,{icon:a.Icon.Snippets,title:"Save as a Snippet",snippet:{text:e,name:t},shortcut:{modifiers:["cmd"],key:"n"}}),x=({icon:e=a.Icon.Trash,title:t,dialog:i,onAction:p,shortcut:s={modifiers:["cmd"],key:"delete"}})=>(0,g.jsx)(a.Action,{style:a.Action.Style.Destructive,icon:e,title:t,onAction:async()=>{await(0,a.confirmAlert)({title:i.title??t,message:i.message??"This action cannot be undone",icon:e,primaryAction:{title:i.primaryButton??t,style:a.Alert.ActionStyle.Destructive,onAction:p}})},shortcut:s});var T=require("@raycast/api");var C=require("react/jsx-runtime"),b=({question:e,answer:t})=>(0,C.jsxs)(T.ActionPanel.Section,{title:"Copy",children:[(0,C.jsx)(P,{title:"Copy Answer",content:t}),(0,C.jsx)(P,{title:"Copy Question",content:e})]});var u=require("@raycast/api"),L=require("react/jsx-runtime"),k=()=>(0,L.jsx)(u.ActionPanel.Section,{title:"Preferences",children:(0,L.jsx)(u.Action,{icon:u.Icon.Gear,title:"Open Extension Preferences",onAction:u.openExtensionPreferences})});var q=require("@raycast/api");var w=require("react/jsx-runtime"),O=({onSaveAnswerAction:e,snippet:t})=>(0,w.jsxs)(q.ActionPanel.Section,{title:"Save",children:[(0,w.jsx)(D,{onAction:e}),t&&(0,w.jsx)(H,{text:t.text,name:t.name})]});var y=require("@raycast/api"),d=require("react");function E(){let[e,t]=(0,d.useState)([]),[i,p]=(0,d.useState)(!0);(0,d.useEffect)(()=>{(async()=>{let n=await y.LocalStorage.getItem("history");n&&(t(r=>[...r,...JSON.parse(n)]),p(!1))})()},[]),(0,d.useEffect)(()=>{y.LocalStorage.setItem("history",JSON.stringify(e))},[e]);let s=(0,d.useCallback)(async n=>{t([...e,n])},[t,e]),A=(0,d.useCallback)(async n=>{let r=await(0,y.showToast)({title:"Removing answer...",style:y.Toast.Style.Animated}),o=e.filter(h=>h.id!==n.id);t(o),r.title="Answer removed!",r.style=y.Toast.Style.Success},[t,e]),f=(0,d.useCallback)(async()=>{let n=await(0,y.showToast)({title:"Clearing history...",style:y.Toast.Style.Animated});t([]),n.title="History cleared!",n.style=y.Toast.Style.Success},[t]);return(0,d.useMemo)(()=>({data:e,isLoading:i,add:s,remove:A,clear:f}),[e,i,s,A,f])}var l=require("@raycast/api"),m=require("react");function N(){let[e,t]=(0,m.useState)([]),[i,p]=(0,m.useState)(!0);(0,m.useEffect)(()=>{(async()=>{let n=await l.LocalStorage.getItem("savedChats");n&&(t(r=>[...r,...JSON.parse(n)]),p(!1))})()},[]),(0,m.useEffect)(()=>{l.LocalStorage.setItem("savedChats",JSON.stringify(e))},[e]);let s=(0,m.useCallback)(async n=>{let r=await(0,l.showToast)({title:"Saving your answer...",style:l.Toast.Style.Animated}),o={...n,saved_at:new Date().toISOString()};t([...e,o]),r.title="Answer saved!",r.style=l.Toast.Style.Success},[t,e]),A=(0,m.useCallback)(async n=>{let r=await(0,l.showToast)({title:"Unsaving your answer...",style:l.Toast.Style.Animated}),o=e.filter(h=>h.id!==n.id);t(o),r.title="Answer unsaved!",r.style=l.Toast.Style.Success},[t,e]),f=(0,m.useCallback)(async()=>{let n=await(0,l.showToast)({title:"Clearing your saved answers...",style:l.Toast.Style.Animated});t([]),n.title="Saved answers cleared!",n.style=l.Toast.Style.Success},[t]);return(0,m.useMemo)(()=>({data:e,isLoading:i,add:s,remove:A,clear:f}),[e,i,s,A,f])}var J=require("@raycast/api"),_=require("react/jsx-runtime"),R=e=>{let{chat:t,markdown:i}=e;return(0,_.jsx)(J.List.Item.Detail,{markdown:i??`**${t.question}**

${t.answer}`})};var c=require("react/jsx-runtime");function B(){let e=N(),t=E(),[i,p]=(0,I.useState)(""),[s,A]=(0,I.useState)(null),f=o=>(0,c.jsxs)(S.ActionPanel,{children:[(0,c.jsx)(b,{answer:o.answer,question:o.question}),(0,c.jsx)(O,{onSaveAnswerAction:()=>e.add(o)}),(0,c.jsx)(S.ActionPanel.Section,{title:"Output"}),(0,c.jsxs)(S.ActionPanel.Section,{title:"Delete",children:[(0,c.jsx)(x,{title:"Remove",dialog:{title:"Are you sure you want to remove this answer from your history?"},onAction:()=>t.remove(o)}),(0,c.jsx)(x,{title:"Clear History",dialog:{title:"Are you sure you want to clear your history?"},onAction:()=>t.clear(),shortcut:{modifiers:["cmd","shift"],key:"delete"}})]}),(0,c.jsx)(k,{})]}),r=t.data.sort((o,h)=>new Date(h.created_at??0).getTime()-new Date(o.created_at??0).getTime()).filter((o,h,V)=>h===V.findIndex(K=>K.id===o.id)).filter(o=>i===""?!0:o.question.toLowerCase().includes(i.toLowerCase())||o.answer.toLowerCase().includes(i.toLowerCase()));return(0,c.jsx)(S.List,{isShowingDetail:r.length!==0,isLoading:t.isLoading,filtering:!1,throttle:!1,navigationTitle:"History",selectedItemId:s||void 0,onSelectionChange:o=>{o!==s&&A(o)},searchBarPlaceholder:"Search answer/question...",searchText:i,onSearchTextChange:p,children:t.data.length===0?(0,c.jsx)(S.List.EmptyView,{title:"No history",description:"Your recent questions will be showed up here",icon:S.Icon.Stars}):(0,c.jsx)(S.List.Section,{title:"Recent",subtitle:r.length.toLocaleString(),children:r.map(o=>(0,c.jsx)(S.List.Item,{id:o.id,title:o.question,accessories:[{text:new Date(o.created_at??0).toLocaleDateString()}],detail:(0,c.jsx)(R,{chat:o}),actions:o&&s===o.id?f(o):void 0},o.id))})})}
